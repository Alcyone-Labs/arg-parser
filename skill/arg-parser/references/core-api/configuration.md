# Core Configuration Reference

Configuration schemas, manifest keys, and wiring for ArgParser.

## Package.json Integration

```json
{
  "name": "@alcyone-labs/arg-parser",
  "version": "2.13.5",
  "type": "module",
  "main": "./dist/index.cjs",
  "module": "./dist/index.mjs",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/index.mjs",
      "require": "./dist/index.cjs",
      "types": "./dist/index.d.ts"
    },
    "./tui": {
      "import": "./dist/tui.mjs",
      "require": "./dist/tui.cjs",
      "types": "./dist/tui.d.ts"
    }
  },
  "peerDependencies": {
    "@opentui/core": "^2.0.0",
    "@opentui/solid": "^2.0.0",
    "solid-js": "^1.8.0"
  },
  "optionalDependencies": {
    "dotenv": "^16.0.0",
    "express": "^4.18.0",
    "js-yaml": "^4.1.0",
    "smol-toml": "^1.1.0",
    "tsdown": "^0.5.0"
  }
}
```

## TypeScript Configuration

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": ["ES2022"],
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "outDir": "./dist",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

## Import Aliases (Internal)

```typescript
// Internal imports within @alcyone-labs/arg-parser use #/* alias

// External imports use package name
import { z } from "zod";
import chalk from "@alcyone-labs/simple-chalk";
import { FlagManager } from "#/core/FlagManager";
import { debug } from "#/utils/debug-utils";
```

## DXT Manifest Schema

Generated by `--s-build-dxt` flag:

```json
{
  "$schema": "https://alcyone-labs.github.io/dxt-manifest/schema.json",
  "name": "my-cli",
  "version": "1.0.0",
  "description": "CLI description",
  "entryPoint": "./dist/index.mjs",
  "supportedRuntimes": ["node"],
  "environmentVariables": {
    "NODE_ENV": {
      "sensitive": false,
      "type": "string",
      "default": "development"
    }
  },
  "flags": {
    "verbose": {
      "sensitive": false,
      "type": "boolean",
      "title": "Verbose output",
      "description": "Enable verbose logging"
    },
    "config": {
      "sensitive": true,
      "type": "file",
      "title": "Configuration file",
      "description": "Path to configuration file"
    }
  },
  "permissions": {
    "fileSystem": {
      "read": ["./"],
      "write": ["./"]
    },
    "network": {
      "allowedHosts": ["api.example.com"]
    }
  }
}
```

## System Flags (Reserved)

These flags are automatically available:

| Flag                     | Type    | Description                       |
| ------------------------ | ------- | --------------------------------- |
| `--s-build-dxt [dir]`    | string  | Build DXT executable to directory |
| `--s-with-node-modules`  | boolean | Include node_modules in DXT       |
| `--s-with-env <file>`    | string  | Load environment from file        |
| `--s-save-to-env <file>` | string  | Save config to file               |
| `--help`, `-h`           | boolean | Show help                         |
| `--version`              | boolean | Show version                      |

## Environment Variable Priority

```
Priority Order (highest to lowest):
1. CLI flag value
2. Environment variable (if env: specified)
3. Default value (from defaultValue or default)
4. Undefined (if optional)
```

## Config Plugin Schema

```typescript
interface IConfigPlugin {
  name: string;
  extensions: string[];
  load(configPath: string): Promise<Record<string, any>>;
  save?(configPath: string, data: Record<string, any>): Promise<void>;
}

interface IConfigPluginRegistry {
  register(plugin: IConfigPlugin): void;
  unregister(name: string): void;
  get(name: string): IConfigPlugin | undefined;
  getExtensions(): string[];
}
```

## MCP Server Configuration

```typescript
interface McpServerConfig {
  serverInfo: {
    name: string;
    version: string;
    description?: string;
  };
  toolOptions?: {
    maxRecursionDepth?: number;
    validateInputSchemas?: boolean;
    validateOutputSchemas?: boolean;
  };
  logPath?: string;
}

interface McpTransportConfig {
  type: "stdio" | "sse" | "streamable-http";
  port?: number;
  host?: string;
  path?: string;
  sessionIdGenerator?: () => string;
  cors?: {
    origin: string | string[];
    credentials: boolean;
  };
  auth?: {
    type: "bearer" | "apikey";
    credentials: Record<string, string>;
  };
}
```

## Output Schema Patterns

```typescript
const OutputSchemaPatterns = {
  successError: z.object({
    success: z.boolean(),
    message: z.string().optional(),
    error: z.string().optional(),
  }),

  successWithData: (dataSchema) =>
    z.object({
      success: z.boolean(),
      data: dataSchema || z.any(),
      message: z.string().optional(),
      error: z.string().optional(),
    }),

  list: (itemSchema) =>
    z.object({
      items: z.array(itemSchema || z.any()),
      count: z.number().optional(),
      hasMore: z.boolean().optional(),
    }),

  fileOperation: z.object({
    path: z.string(),
    size: z.number().optional(),
    created: z.boolean().optional(),
    modified: z.boolean().optional(),
    exists: z.boolean().optional(),
  }),

  processExecution: z.object({
    exitCode: z.number(),
    stdout: z.string().optional(),
    stderr: z.string().optional(),
    duration: z.number().optional(),
    command: z.string().optional(),
  }),
};
```

## Logger Configuration

```typescript
interface Logger {
  info(message: string, meta?: Record<string, any>): void;
  warn(message: string, meta?: Record<string, any>): void;
  error(message: string, meta?: Record<string, any>): void;
  debug(message: string, meta?: Record<string, any>): void;
  child(prefix: string): Logger;
}

// In MCP mode, logger routes to STDERR to avoid protocol contamination
```

## Vite Build Configuration

```typescript
// vite.config.ts
import { defineConfig } from "vite";
import dts from "vite-plugin-dts";
import tsdown from "vite-plugin-tsdown";

export default defineConfig({
  plugins: [
    tsdown({
      entry: ["src/index.ts", "src/tui/index.ts"],
      format: {
        esm: true,
        cjs: true,
        iife: false,
      },
      dts: true,
      minify: true,
    }),
    dts({
      tsconfigPath: "tsconfig.json",
    }),
  ],
  build: {
    lib: {
      entry: "src/index.ts",
      formats: ["es", "cjs"],
      fileName: (format) => `index.${format}.js`,
    },
    rollupOptions: {
      external: ["zod", "solid-js", "@opentui/core", "@opentui/solid"],
    },
  },
});
```
